domain authentication \  services
    Kerbereos \ NTLM \  LDAP \  SMB \  RDP

        --- kerberos provides more secure authentication without the need for transmission of user credentials than LDAP or NTLM
        --- adversaried who have acces to system memory can access either the Kerberos Ticket Granting Ticket TGT, NTLM Hasg or LDAP auth credentials
        ---RDP is commonly abused by adversaries to move laterally through a network 
        --- SMB is very common protocol as it provides core network features for file share and network backups
        

- Accessing resources within a domain requires authentication mechanisms
this is usually in the form of

- authentication services
- network protocols
- client / server software 

- the authentication layer in a domain is coveted by adversaries
- adversaries are able to authenticate domain resources while appearing as a legitimate user if they breach the authentication layer of a network

password policy and other account management GPO is required for basic cyber hygiene
unfortunately, many authentication protocols can be compromised even within the most hardended domain




Kerberos
UDP port 88

- an authentication protocal that communicates over the network
- client to server protocol that does not require the authentication \ authorization process to interface with the requested resource
- utilizes a key distribution center ( KDC ) service running on the domain controller 
- KDC provides third party review of requests and authentication attempts regarding access to network resources
- commonly communicates over UDP port 88




LDAP
port 389 and 636

- lightweight directory access protocol
- an open and cross platform protocol used to query and communicate with directory services 
- works with windows Active Directory 
- OpenLDAP, Apache Directory is also compatible 
- a viable option for directory services vs kerberos 
- observed using TCP/UDP over ports 389 and 636

LDAP process

-login attempt
-bind attempt
-bind response
-login response

must be used over tls *secure




NTLM
UDP port 137 \ 138 \ 139

- NT Lan Manager
- older authentication protocol that you will still see in older windows domain deployments ( widely supported )
- introduced in NT 3.0 - 1996
- rather than using private keys, uses a challenge and response between the client / server and server / domain controller
- NTLM uses hashes generated by the domain controller and sent to clinets for authentication to resources 
- utilizes weak cryptography and MD5 ( reversible )
- runs on UDP ports 137 / 138 / 139


NTLM process

-client requests access to resource
-resource generates random one time string to be encrypted by client
-client encrypts string with password hash ( MD5 )
-server provides encrypted challenge from client
-AD validates the encrypted challenge is an authroized user
-server provides response to client request




RDP
TCP port 3389

- remote desktop protocol
- provides access to a windows machine via a GUI 
- foundry uses RDP to run CDA workstations
- remote users can provide windows credentials using RDP to the target host to authenticate and log into that host 
- the credentials can be used to log on as a local account if the machine isnt joined to a domain.
- adversaries can use RDP to infect one device, then steal admin credentials form memory or disk and compromise the network 




SMB

- server message block
- network file shariing protocol that allows applications on a computer to read and write to files and request services from server programs in a computer network

In a windows domain, SMB is used for

- network file and file share access
- group policy updates via domain network share ( SYSVOL )
- network backups of local system files 
- observed using TCP port 139 = legacy NETBIOS transport protocol
- observed using TCP port 445 = SMB over IP ( Internet Protocol )
